#
# Bird AS112 configuration generated by IXP Manager
#
# Do not edit this file, it will be overwritten.
#
# Generated: 2025-08-30 12:00:56
#

# For VLAN: Peering LAN 2 (Tag: 2, Database ID: 2)

# standardise time formats:
timeformat base         iso long;
timeformat log          iso long;
timeformat protocol     iso long;
timeformat route        iso long;


log "/var/log/bird/b2-as112-lan2-ipv4.log" all;
log syslog name "bird-b2-as112-lan2-ipv4" all;

define routerasn     = 112;
define routeraddress = 192.0.2.16;

router id 192.0.2.16;

protocol kernel {
    ipv4 {
        export all;
    };
    scan time 120;
}

protocol device {
    scan time 10;
}

# These function excludes weird networks
#  rfc1918, class D, class E, too long and too short prefixes
function avoid_martians() -> bool
prefix set martians;
{
    
        martians = [
            0.0.0.0/32-,            # rfc5735 Special Use IPv4 Addresses
            0.0.0.0/0{25,32},       # Filter small prefixes
            0.0.0.0/0{0,7},         # rfc1122 Requirements for Internet Hosts -- Communication Layers 3.2.1.3
            10.0.0.0/8+,            # rfc1918 Address Allocation for Private Internets
            100.64.0.0/10+,         # rfc6598 IANA-Reserved IPv4 Prefix for Shared Address Space
            127.0.0.0/8+,           # rfc1122 Requirements for Internet Hosts -- Communication Layers 3.2.1.3
            169.254.0.0/16+,        # rfc3927 Dynamic Configuration of IPv4 Link-Local Addresses
            172.16.0.0/12+,         # rfc1918 Address Allocation for Private Internets
            192.0.0.0/24+,          # rfc6890 Special-Purpose Address Registries
            192.0.2.0/24+,          # rfc5737 IPv4 Address Blocks Reserved for Documentation
            192.168.0.0/16+,        # rfc1918 Address Allocation for Private Internets
            198.18.0.0/15+,         # rfc2544 Benchmarking Methodology for Network Interconnect Devices
            198.51.100.0/24+,       # rfc5737 IPv4 Address Blocks Reserved for Documentation
            203.0.113.0/24+,        # rfc5737 IPv4 Address Blocks Reserved for Documentation
            224.0.0.0/4+,           # rfc1112 Host Extensions for IP Multicasting
            240.0.0.0/4+            # rfc6890 Special-Purpose Address Registries
        ];

    
    # Avoid RFC1918 and similar networks
    if ( net ~ martians ) then {
        return false;
    }

    return true;
}


# This protocol defines the routes we want to export for AS112

protocol static static_as112 {


    ipv4;
    route 192.175.48.0/24 blackhole;
    route 192.31.196.0/24 blackhole;


}

##
## AS112 client configuration
##



########################################################################################
########################################################################################
#
# RPKI protocol configuration
#
########################################################################################
########################################################################################


    
# RPKI not enabled for this router

    



function fn_import ( int remote_as )
{
    if !(avoid_martians()) then {
        return false;
    }

    # Belt and braces: must have at least one ASN in the path
    if( bgp_path.len < 1 ) then {
        return false;
    }

    # Belt and braces: no one needs an ASN path with > 64 hops, that's just broken
    if( bgp_path.len > 64 ) then {
        return false;
    }

    
    # Skipping RPKI check, protocol not enabled.

    
    return true;
}


protocol bgp pb_as1213_vli2_ipv4 {
        description "AS1213 - HEAnet";
        local as routerasn;
        source address routeraddress;
        neighbor 10.2.0.11 as 1213;
        strict bind yes;
        enforce first as on;
        ipv4 {
            import where fn_import( 1213 );
            import limit 1000 action restart;
            export where proto = "static_as112";
        };
        password "u5zSNJLAVT87RGXQ";
}


