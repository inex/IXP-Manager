#
# Bird AS112 configuration generated by IXP Manager
#
# Do not edit this file, it will be overwritten.
#
# Generated: 2016-11-08 18:51:42
#

# For VLAN: Peering LAN 1 (Tag: 1, Database ID: 1)

# standardise time formats:
timeformat base         iso long;
timeformat log          iso long;
timeformat protocol     iso long;
timeformat route        iso long;


log "/var/log/bird/as112-lan1-ipv6.log" all;
log syslog all;

define routerasn     = 112;
define routeraddress = 2001:db8:0:0:2::6;

router id 192.0.2.6;
listen bgp address routeraddress;

protocol kernel {
    export all;
    scan time 60;
}

protocol device {
    scan time 10;
}

# These function excludes weird networks
#  rfc1918, class D, class E, too long and too short prefixes


function avoid_martians_v6()
prefix set martiansv6;
{
        # This list of martians is obtained from the IANA IPv6
        # Special-Purpose Address Registry:
        # http://www.iana.org/assignments/iana-ipv6-special-registry
        martiansv6 = [
                ::/0,                   # Default (can be advertised as a route in BGP to peers if desired)
                ::/96,                  # IPv4-compatible IPv6 address - deprecated by RFC4291
                ::/128,                 # Unspecified address
                ::1/128,                # Local host loopback address
                ::ffff:0.0.0.0/96+,     # IPv4-mapped addresses
                ::224.0.0.0/100+,       # Compatible address (IPv4 format)
                ::127.0.0.0/104+,       # Compatible address (IPv4 format)
                ::0.0.0.0/104+,         # Compatible address (IPv4 format)
                ::255.0.0.0/104+,       # Compatible address (IPv4 format)
                0000::/8+,              # Pool used for unspecified, loopback and embedded IPv4 addresses
                0100::/64+,             # RFC6666 - discard-only address block
                0200::/7+,              # RFC4548 - OSI NSAP-mapped prefix set, deprecated by RFC4048
                3ffe::/16+,             # Former 6bone, now decommissioned
                2001:2::/48+,           # RFC5180 - Benchmarking
                2001:10::/28+,          # RFC4843 - ORCHID
                2001:db8::/32+,         # RFC3849 - Reserved by IANA for special purposes and documentation
                2002:e000::/20+,        # Invalid 6to4 packets (IPv4 multicast)
                2002:7f00::/24+,        # Invalid 6to4 packets (IPv4 loopback)
                2002:0000::/24+,        # Invalid 6to4 packets (IPv4 default)
                2002:ff00::/24+,        # Invalid 6to4 packets
                2002:0a00::/24+,        # Invalid 6to4 packets (IPv4 private 10.0.0.0/8 network)
                2002:ac10::/28+,        # Invalid 6to4 packets (IPv4 private 172.16.0.0/12 network)
                2002:c0a8::/32+,        # Invalid 6to4 packets (IPv4 private 192.168.0.0/16 network)
                fc00::/7+,              # RFC4193 - Unicast Unique Local Addresses (ULA)
                fe80::/10+,             # Link-local Unicast
                fec0::/10+,             # Site-local Unicast - deprecated by RFC 3879 (replaced by ULA)
                ff00::/8+,              # Multicast
                ::/0{49,128}            # Filter small prefixes
        ];

        # Avoid RFC1918 and similar networks
        if net ~ martiansv6 then
                return false;

        return true;
}

filter f_import_policy
{
        if !(avoid_martians_v6()) then
                reject;

        accept;
}



# This protocol defines the routes we want to export for AS112

protocol static static_as112 {


    route 2620:4f:8000::/48 blackhole;
    route 2001:4:112::/48 blackhole;


}

##
## AS112 client configuration
##




protocol bgp pb_as1213_vli1_ipv6 {
        description "AS1213 - HEAnet";
        local as routerasn;
        source address routeraddress;
        neighbor 2001:db8:1::10 as 1213;
        import filter f_import_policy;
        export where proto = "static_as112";
        import limit 1000 action restart;
        
}


