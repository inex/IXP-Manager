name: ipfix-sros

mgmt:
  network: ixpm_ixpmanager # Connect to IXP manager network
  # bridge: mgmt-bridge
  ipv4-subnet: 172.30.201.0/24

topology:
  kinds:
    linux:
      image: ghcr.io/hellt/network-multitool

  nodes:
    sros:
      kind: vr-nokia_sros
      image: vrnetlab/vr-sros:23.10.R3
      license: /Projects/SR_OS_VSR-SIM_license.txt
      startup-config: |
        /configure port 1/1/c1 admin-state enable connector breakout c1-100g
        /configure port 1/1/c1/1 admin-state enable ethernet mode access encap-type dot1q
        /configure cflowd collector 172.30.201.1 port 9995 version 10 router-instance "management" admin-state enable template-set l2-ip
        /configure cflowd active-flow-timeout 30 sample-profile 1 sample-rate 1
        /configure service vpls "1" admin-state enable service-id 1 customer "1" sap 1/1/c1/1:100 { cflowd true }
        /configure service vpls "1" interface "i" { ipv4 primary address 192.168.0.0 prefix-length 31 }

    ### CLIENTS ###
    client1:
      kind: linux
      exec:
        - ip link add link eth1 name eth1.100 type vlan id 100
        - ip address add 192.168.0.1/31 dev eth1.100
        - ip route replace default via 192.168.0.0
        - ip -6 address add 2002::192:168:0:1/64 dev eth1.100
        # - iperf3 -s -p 5201 -D > iperf3_1.log
        # - iperf3 -s -p 5202 -D > iperf3_2.log
      group: server
       
  links:
    - endpoints: ["sros:eth1","client1:eth1"]